{{ partial "head.html" . }}
<main class="list list--storyline">
    <div class="container">
        <nav class="list__nav">
            <h3 class="tag">
                <span class="tag__text">Archive filters</span>
                <i class="icon-button--red tag__bg"></i>
            </h3>
            <main class="list__nav--main">
                <!-- define baseurl -->
                {{ $baseurl := .Site.BaseURL }}
                {{ $singular := ( .Title | singularize) }}
                <!-- define metadata stuff -->
                {{ $metadata := index $.Site.Data.metadata $singular }}
                <!-- define characters stuff -->
                {{ $char_title := ( replace .Title " " "-" ) }} 
                {{ $character := index $.Site.Data.characters $char_title }}
                <!-- begin filters -->
                
                <div>
                    <label>By storyline:</label>
                    <ul class="ul ul--list ul--list_tags">
                        {{ range where $.Site.Pages.ByDate ".Params.storyline" "!=" nil }}
                            {{ $link := .Permalink }}
                            {{ range $name, $taxonomy := .Site.Taxonomies }}
                                {{ if eq "storyline" $name }}
                                    {{ range $key, $value := $taxonomy }}
                                        {{ $count := .Count }}
                                        {{ range first 1 $value.Pages }}
                                            {{ if (eq .Permalink $link) }}
                                                <li class="tags">
                                                    <a href="/storyline/{{ $key | urlize }}" class="tag tag--storyline" title="{{ $count }} comics within the &ldquo;{{ humanize (string $key) }}&rdquo; storyline">
                                                        <span class="tag__text">{{ humanize (string $key) }}</span><i class="tag__bg icon-button--teal"></i>
                                                    </a>
                                                </li>
                                            {{ end }}
                                        {{ end }}
                                    {{ end }}
                                {{ end }}
                            {{ end }}
                        {{ end }}
                    </ul>
                </div>

                <div>
                    <label>By character:</label>
                    <ul class="ul ul--list ul--list_tags">
                        {{ range $name, $taxonomy := .Site.Taxonomies.characters }}
                        <li class="tags">
                            <a href="/characters/{{ $name | urlize }}" class="tag tag--character" title="{{ .Count }} comics featuring &ldquo;{{ $name }}&rdquo;">
                                <span class="tag__text">{{ $name }}</span><i class="icon-button--grey tag__bg"></i>
                            </a>
                        </li>
                        {{ end }}
                    </ul>
                </div>

                <div>
                    <ul class="ul ul--list ul--list_tags">
                        <li class="tags">
                            <a href="/tags/" class="tag tag--section" title="View a list of all defined tags">
                                <span class="tag__text">Search by tag</span>
                                <i class="icon-button--red tag__bg"></i>
                            </a>
                        </li>
                    </ul>
                </div>
                <div>
                    <ul class="ul ul--list ul--list_tags">
                        <li class="tags">
                            <a href="/chipmunkbay" class="tag tag--section" title="Browse the archives">
                                <span class="tag__text">Browse all</span>
                                <i class="icon-button--red tag__bg"></i>
                            </a>
                        </li>
                    </ul>
                </div>

                <div>
                    <label>Switch to another comic series:</label>
                    <ul class="ul ul--list ul--list_tags">
                        {{ range $section, $taxonomy := .Site.Sections }}
                            {{ $m := index $.Site.Data.metadata (title $section) }}
                            {{ if isset $m "name" }}
                            <li class="tags">
                                <a href="/{{ $section | urlize }}" class="tag tag--character" title="Browse the archives">
                                    <span class="tag__text">{{ $m.name }}</span>
                                    <i class="icon-button--green tag__bg"></i>
                                </a>
                            </li>
                            {{ end }}
                        {{ end }}
                    </ul>
                </div>
                
            </main>
        </nav>
        <section class="list__results">
            
            <!-- define paginator -->
            
            {{ $pag := (.Paginate (where .Data.Pages.GroupByDate "2006-01" "asc") 5) }}


            <header class="list__results--header">
                <h3 class="list__results--h3">Comics in the <span>"{{ .Title }}"</span> storyline</h3> 
                <p>{{ $pag.NumberOfElements }} Results</p>
                <p>{{ $pag.HasPrev }} Results</p>
                <p>{{ $pag.Pagers }} Results</p>
                <p>{{ $pag.TotalPages }} Results</p>
                <p>{{ $pag.TotalNumberOfElements }} Results. Showing </p>
                
                <p>Showing $$-$$ of $$ total comics.</p>
            </header>

            <main class="list__results--main">
                <ul class="ul">                    
                    <!-- return actual results -->
                    {{ range $index, $pag.Pages.ByDate }}

                    <li class="list__results--item">
                        <div class="list__results--info">
                            <a href="{{ .Permalink }}" title="{{ .Title }}" class="list__results--title">
                                {{.Title}}
                            </a>
                            <span class="list__results--date">{{ .Date.Format "Jan 2, 2006" }}</span>
                        </div>
                        <div class="list__results--comic">
                            {{ partial "comic__comic.html" . }}
                            <aside class="list__results--tags">
                                <p>Tags:</p>
                                <!-- tags -->
                                {{ if and (isset .Params "tags") (and (not (eq .Params.tags "")) (not (eq .Params.tags nil))) }}
                                
                                    <!--<label>tags</label>-->
                                    {{ range .Params.tags }}
                                        <a href="{{ "/tags/" }}{{ . | urlize }}" class="tag tag--tag" title="Comics tagged as &ldquo;{{ . }}&rdquo;">
                                            <span class="tag__text">{{ . }}</span><i class="icon-button--tan tag__bg"></i>                            
                                        </a> 
                                    {{ end }} 
                                
                                {{ end }}

                                <!-- characters -->
                                {{ if and (isset .Params "characters") (and (not (eq .Params.characters "")) (not (eq .Params.characters nil))) }}
                                
                                    <!--<label>characters</label>-->
                                    {{ range .Params.characters }}
                                        <a href="{{ "/characters/" }}{{ . | urlize }}" class="tag tag--character" title="Comics featuring &ldquo;{{ . }}&rdquo;">
                                            <span class="tag__text">{{ . }}</span><i class="icon-button--grey tag__bg"></i>                            
                                        </a>
                                    {{ end }} 
                                
                                {{ end }}

                                <!-- storyline -->
                                {{ if and (isset .Params "storyline") (and (not (eq .Params.storyline "")) (not (eq .Params.storyline nil))) }}
                                
                                    <!--<label>storyline</label>-->
                                    {{ range .Params.storyline }}
                                        <a href="{{ "/storyline/" }}{{ . | urlize }}" class="tag tag--storyline" title="Comics in the &ldquo;{{ . }}&rdquo; storyline">
                                            <span class="tag__text">{{ . }}</span><i class="icon-button--teal tag__bg"></i>                            
                                        </a>
                                    {{ end }} 
                                
                                {{ end }}
                            </aside>
                            <footer class="list__results--share">
                                <ul class="ul ul--list">
                                    <li>
                                        <a href="http://www.facebook.com/share.php?u={{ .URL | absURL }}" title="Share on Facebook" class="tag">
                                            <span class="icon-facebook tag__text">facebook</span>
                                            <i class="icon-tag--facebook tag__bg"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://twitter.com/intent/tweet?url={{ .URL | absURL }}&text={{ .Title }}" title="Share on Twitter" class="tag">
                                            <span class="icon-twitter tag__text">twitter</span>
                                            <i class="icon-tag--twitter tag__bg"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://plus.google.com/share?url={{ .URL | absURL }}" title="Share on Google+" class="tag">
                                            <span class="icon-gplus tag__text">google plus</span>
                                            <i class="icon-tag--red tag__bg"></i>
                                        </a>
                                    </li>
                                </ul>
                            </footer>
                        </div>
                    </li>
                    {{ end }}
                    <!-- end results for this page -->
                </ul>
            </main>
            <!-- if there are pages, render pagination -->
            <footer class="list__results--footer">
                {{ if or ($pag.HasPrev) ($pag.HasNext) }}
                <ul class="ul ul-inline pagination">
                    <!-- if there are more than 1 pages of results -->
                    {{ if gt $pag.TotalPages 1 }}
                    <li {{ if not $pag.HasPrev }} class="disabled" {{ end }}>
                        <a aria-label="First" href="{{ $baseurl }}{{ $pag.First.URL }}">
                            <span aria-hidden="true">&laquo;&laquo;</span>
                        </a>
                    </li>
                    <li {{ if not $pag.HasPrev }} class="disabled" {{ end }}>
                        <a aria-label="Previous" href="{{ if $pag.HasPrev }}{{ $baseurl }}{{ $pag.Prev.URL }}{{ else }}#{{ end }}">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    {{ range $pag.Pagers }}
                    <li {{ if eq . $pag }} class="active" {{ end }}>
                        <a href="{{ $baseurl }}{{ .URL }}">
                    {{ .PageNumber }}
                </a>
                    </li>
                    {{ end }}
                    <li {{ if not $pag.HasNext }} class="disabled" {{ end }}>
                        <a aria-label="Next" href="{{ if $pag.HasNext }}{{ $baseurl }}{{ $pag.Next.URL }}{{ else }}#{{ end }}">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    <li {{ if not $pag.HasNext }} class="disabled" {{ end }}>
                        <a aria-label="Last" href="{{ $baseurl }}{{ $pag.Last.URL }}">
                            <span aria-hidden="true">&raquo;&raquo;</span>
                        </a>
                    </li>
                    {{ end }}
                </ul>
                {{ end }}
            </footer>
            <!-- end pagination -->
        </section>
    </div>
</main>
</div>
{{ partial "footer.html" . }}
