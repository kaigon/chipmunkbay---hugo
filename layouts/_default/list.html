{{ partial "head.html" . }}
<main class="list">
    <div class="container">
        <nav>
            <main>
                <!-- define baseurl -->
                {{ $baseurl := .Site.BaseURL }}
                {{ $singular := ( .Title | singularize) }}
                <!-- define metadata stuff -->
                {{ $metadata := index $.Site.Data.metadata $singular }}
                <!-- define characters stuff -->
                {{ $char_title := ( replace .Title " " "-" ) }} 
                {{ $character := index $.Site.Data.characters $char_title }}
                <!-- begin filters -->
                <h3>Archive filters:</h3>
                {{ if and (isset $metadata "name") (eq $metadata.name "Chipmunk Bay") }}
                <div>
                    <label>By storyline:</label>
                    <ul class="ul ul--list ul--list_tags">
                        {{ range $name, $taxonomy := .Site.Taxonomies.storyline }}
                        <li class="tags--storyline tags">
                            <a href="/storyline/{{ $name | urlize }}" class="tag" title="Comics featuring &ldquo;{{ $name }}&rdquo;">
                                <span>{{ humanize (string $name) }}<label>{{ .Count }}</label></span><i class="icon-button" data-grunticon-embed></i>
                            </a>
                        </li>
                        {{ end }}
                    </ul>
                </div>


                <!-- BEGIN TEST //-->
                <div>
                    <label>TEST:</label>
                    <ul class="ul ul--list ul--list_tags">
                        {{ range .Site.Pages.GroupByParam "storyline" }}
                            {{range first 1 .Pages.ByDate.Reverse }}
                            <li>{{.Params.storyline}}</li>
                            {{ end }}
                        {{ end }}
                    </ul>
                </div>
                <!--// END TEST -->


                <div>
                    <label>By character:</label>
                    <ul class="ul ul--list ul--list_tags">
                        {{ range $name, $taxonomy := .Site.Taxonomies.characters }}
                        <li class="tags--characters tags">
                            <a href="/characters/{{ $name | urlize }}" class="tag" title="Comics featuring &ldquo;{{ $name }}&rdquo;">
                                <span>{{ $name }}<label>{{ .Count }}</label></span><i class="icon-tag" data-grunticon-embed></i>
                            </a>
                        </li>
                        {{ end }}
                    </ul>
                </div>
                <div>
                    <label>By tag:</label>
                    <ul class="ul ul--list ul--list_tags">
                        {{ range $name, $taxonomy := .Site.Taxonomies.tags }}
                        <li class="tags--tags tags">
                            <a href="/tags/{{ $name | urlize }}" class="tag" title="Comics featuring &ldquo;{{ $name }}&rdquo;">
                                <span>{{ $name }}<label>{{ .Count }}</label></span><i class="icon-tag" data-grunticon-embed></i>
                            </a>
                        </li>
                        {{ end }}
                    </ul>
                </div>
                <div>
                    <ul class="ul ul--list ul--list_tags">
                        <li class="tags tags--section">
                            <a href="/chipmunkbay" class="tag" title="Browse the archives">
                                <span>View all</span>
                                <i class="icon-button" data-grunticon-embed></i>
                            </a>
                        </li>
                    </ul>
                </div>
                {{ end }}
                <div>
                    <label>Switch Archives:</label>
                    <ul class="ul ul--list ul--list_tags">
                        {{ range $section, $taxonomy := .Site.Sections }}
                            {{ $m := index $.Site.Data.metadata (title $section) }}
                            {{ if isset $m "name" }}
                            <li class="tags--characters tags">
                                <a href="/{{ $section | urlize }}" class="tag" title="Browse the archives">
                                    <span>{{ $m.name }}</span>
                                    <i class="icon-button" data-grunticon-embed></i>
                                </a>
                            </li>
                            {{ end }}
                        {{ end }}
                    </ul>
                </div>
            </main>
        </nav>
        <section>
            <header>
                <!-- archives for comic section -->
                <!-- ex: Chipmunk Bay, or Team N3 -->
                {{ if isset $metadata "name" }}
                    <h1>{{ $metadata.name }} archives</h1>
                <!-- all comics featuring a set tag -->
                <!-- ex: all comics tagged as 'starcraft' -->
                {{ else if isset .Data "tags" }}
                    <h1>Comics tagged as "{{ .Title }}"</h1>
                <!-- all comics featuring a specific character -->
                <!-- ex: all comics featuring 'Karen' -->
                {{ else if isset .Data "characters" }} 
                    <!-- if thumbnail exists -->
                    {{ if isset $character "thumb" }}
                    <figure>
                        <img src="{{ $baseurl }}_files/img/thumb/{{ $character.thumb }}" alt="profile picture for {{ $character.fullname }}">
                    </figure>
                    {{ end }}
                    <div>
                        <label>Comics featuring</label>
                        <h1>{{ .Title }}</h1> 
                        {{ if isset $character "level" }}
                        <label class="tag"><span>{{ $character.level }} cast member</span><i class="icon-tag" data-grunticon-embed></i></label>
                        {{ end }}
                    </div>
                <!-- all comics in a set storyline -->
                <!-- ex: all comics in the 'Shawn has a date' storyline -->
                {{ else if isset .Data "storyline" }}
                    <label class="label">Storyline</label>
                    <h1>{{ .Title }}</h1> 
                {{ end }}
            </header>
            <!--<p>$$$ total comics. Showing $$-$$.</p>-->
            <main>
                <ul class="ul">
                    <!-- define paginator -->
                    {{ $pag := .Paginator 25 }}
                    <!-- return actual results -->
                    {{ range $index, $pag.Pages.ByDate }}
                    <li>
                        <a href="{{ .Permalink }}" title="{{ .Title }}">
                            {{.Title}}
                        </a>
                        <span>{{ .Date.Format "Jan 2, 2006" }}</span>
                    </li>
                    {{ end }}
                    <!-- end results for this page -->
                </ul>
            </main>
            <!-- if there are pages, render pagination -->
            <footer>
                {{ if or ($pag.HasPrev) ($pag.HasNext) }}
                <ul class="ul ul-inline pagination">
                    <!-- if there are more than 1 pages of results -->
                    {{ if gt $pag.TotalPages 1 }}
                    <li {{ if not $pag.HasPrev }} class="disabled" {{ end }}>
                        <a aria-label="First" href="{{ $baseurl }}{{ $pag.First.URL }}">
                            <span aria-hidden="true">&laquo;&laquo;</span>
                        </a>
                    </li>
                    <li {{ if not $pag.HasPrev }} class="disabled" {{ end }}>
                        <a aria-label="Previous" href="{{ if $pag.HasPrev }}{{ $baseurl }}{{ $pag.Prev.URL }}{{ else }}#{{ end }}">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    {{ range $pag.Pagers }}
                    <li {{ if eq . $pag }} class="active" {{ end }}>
                        <a href="{{ $baseurl }}{{ .URL }}">
                    {{ .PageNumber }}
                </a>
                    </li>
                    {{ end }}
                    <li {{ if not $pag.HasNext }} class="disabled" {{ end }}>
                        <a aria-label="Next" href="{{ if $pag.HasNext }}{{ $baseurl }}{{ $pag.Next.URL }}{{ else }}#{{ end }}">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    <li {{ if not $pag.HasNext }} class="disabled" {{ end }}>
                        <a aria-label="Last" href="{{ $baseurl }}{{ $pag.Last.URL }}">
                            <span aria-hidden="true">&raquo;&raquo;</span>
                        </a>
                    </li>
                    {{ end }}
                </ul>
                {{ end }}
            </footer>
            <!-- end pagination -->
        </section>
    </div>
</main>
</div>
{{ partial "footer.html" . }}
